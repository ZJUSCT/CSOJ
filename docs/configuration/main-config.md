# Main Config (config.yaml)

`config.yaml` is the primary configuration file for the CSOJ system. It defines the core behavior of the service, including listen addresses, storage paths, authentication methods, and judger clusters.

## Full Configuration Example

```yaml
# Listen address for the user-facing API
listen: ":8080"

# Configuration for the Admin API service
admin:
  enabled: true
  listen: ":8081"

# Logger configuration
logger:
  level: "debug" # Options: "debug", "production"
  file: ""       # Path to log file. If empty, logs to console.

# Storage path configuration
storage:
  user_avatar: "data/avatars"        # User avatars
  submission_content: "data/submissions" # User-submitted files
  database: "data/csoj.db"           # SQLite database file
  submission_log: "data/logs"        # Logs from judging containers

# Authentication configuration
auth:
  jwt:
    secret: "a_very_secret_key_change_me" # JWT signing secret, MUST be changed
    expire_hours: 72                     # JWT expiration time in hours
  
  # Local username/password authentication
  local:
    enabled: true
  
  # GitLab OAuth2 authentication
  gitlab:
    url: "[https://gitlab.com](https://gitlab.com)"
    client_id: "YOUR_GITLAB_CLIENT_ID"
    client_secret: "YOUR_GITLAB_CLIENT_SECRET"
    redirect_uri: "http://localhost:8080/api/v1/auth/gitlab/callback"
    frontend_callback_url: "http://localhost:3000/callback" # URL for frontend to handle the final redirect with the token

# Cross-Origin Resource Sharing (CORS) configuration
cors:
  allowed_origins:
    - "http://localhost:3000"
    - "[http://127.0.0.1:3000](http://127.0.0.1:3000)"

# Dynamic links for the frontend navigation bar
links:
  - name: "Project Source"
    url: "[https://github.com/ZJUSCT/CSOJ](https://github.com/ZJUSCT/CSOJ)"
  - name: "About"
    url: "/about"

# Judger cluster configuration
cluster:
  - name: "default-cluster" # Cluster name, referenced in problem configs
    node:
      - name: "node-1"
        cpu: 4           # Total CPU cores available for judging
        memory: 4096       # Total memory (in MB) available for judging
        docker: # Docker Daemon connection settings for this node
          host: "tcp://192.168.1.101:2375"
          tls_verify: false
          # ca_cert: "/path/to/ca.pem"
          # cert: "/path/to/cert.pem"
          # key: "/path/to/key.pem"
      - name: "node-2"
        cpu: 8
        memory: 8192
        docker:
          host: "tcp://192.168.1.102:2375"

# List of paths to contest configuration directories
contest:
  - "contests/intro-contest"
  - "contests/final-contest"
```

-----

## Field Reference

### `listen`

  - **Type**: `string`
  - **Required**: Yes
  - **Description**: The listen address and port for the user-facing API service.

-----

### `admin`

  - **Type**: `object`
  - **Required**: No
  - **Description**: Configuration for the Admin API service.
      - `enabled`: (boolean) Whether to enable the Admin API service.
      - `listen`: (string) The listen address and port for the Admin API service.

-----

### `logger`

  - **Type**: `object`
  - **Required**: Yes
  - **Description**: Configuration for the logging system.
      - `level`: (string) Log level. `debug` provides more verbose output, while `production` is more concise.
      - `file`: (string) Path to a log file. If left empty, logs are written to standard output/error (the console).

-----

### `storage`

  - **Type**: `object`
  - **Required**: Yes
  - **Description**: Defines storage paths for various system files.
      - `user_avatar`: (string) Directory to store user-uploaded avatars.
      - `submission_content`: (string) Directory to store user-submitted code/files.
      - `database`: (string) Path to the SQLite database file.
      - `submission_log`: (string) Directory to store log files generated by each judging container.

-----

### `auth`

  - **Type**: `object`
  - **Required**: Yes
  - **Description**: User authentication settings.
      - `jwt`: (object)
          - `secret`: (string) The secret key used to sign and verify JWTs. **You must change this to a complex random string in production.**
          - `expire_hours`: (integer) The validity period of a JWT, in hours.
      - `local`: (object)
          - `enabled`: (boolean) Whether to enable the local username and password registration/login feature.
      - `gitlab`: (object)
          - `url`: (string) The URL of your GitLab instance's OIDC provider.
          - `client_id`: (string) The Client ID obtained after creating an application in GitLab.
          - `client_secret`: (string) The Client Secret obtained after creating an application in GitLab.
          - `redirect_uri`: (string) The callback URL configured in your GitLab application, which must exactly match this URI.
          - `frontend_callback_url`: (string) The URL on your frontend application where users are redirected after a successful login. The JWT will be appended as a `?token=` query parameter.

-----

### `cors`

  - **Type**: `object`
  - **Required**: No
  - **Description**: Configures Cross-Origin Resource Sharing (CORS) for the API.
      - `allowed_origins`: (array of strings) A list of origins that are allowed to access the API. You can add your frontend application's address here. Supports `*` as a wildcard.

-----

### `links`

  - **Type**: `array of objects`
  - **Required**: No
  - **Description**: Defines a list of dynamic links to be displayed in the frontend's main navigation bar.
      - `name`: (string) The text to display for the link.
      - `url`: (string) The destination URL. Can be an internal path (e.g., `/about`) or an external URL (e.g., `https://github.com/ZJUSCT/CSOJ`).

-----

### `cluster`

  - **Type**: `array of objects`
  - **Required**: Yes
  - **Description**: Defines one or more judger clusters. Each cluster consists of one or more judger nodes.
      - `name`: (string) A unique name for the cluster. This name is used in problem configurations to specify which cluster to use for judging.
      - `node`: (array of objects) The list of judger nodes in this cluster.
          - `name`: (string) A unique name for the node.
          - `cpu`: (integer) The total number of CPU cores that the scheduler can use on this node.
          - `memory`: (integer) The total amount of memory (in MB) that the scheduler can use on this node.
          - `docker`: (object) The connection settings for the Docker Daemon on this node.
              - `host`: (string) The API address, typically a TCP address like `tcp://127.0.0.1:2375`.
              - `tls_verify`: (boolean, optional) Whether to use TLS to connect to the daemon.
              - `ca_cert`, `cert`, `key`: (string, optional) Paths to TLS certificate files if `tls_verify` is true.

-----

### `contest`

  - **Type**: `array of strings`
  - **Required**: Yes
  - **Description**: A list of paths to all contest configuration directories. CSOJ scans these directories on startup to load contest and problem information.
