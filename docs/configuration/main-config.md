# Main Config (config.yaml)

`config.yaml` is the primary configuration file for the CSOJ system. It defines the core behavior of the service, including listen addresses, storage paths, authentication methods, and judger clusters.

## Full Configuration Example

```yaml
# Listen address for the user-facing API
listen: ":8080"

# Configuration for the Admin API service
admin:
  enabled: true
  listen: ":8081"

# Logger configuration
logger:
  level: "debug" # Options: "debug", "production"
  file: ""       # Path to log file. If empty, logs to console.

# Storage path configuration
storage:
  user_avatar: "data/avatars"           # User avatars
  submission_content: "data/submissions" # User-submitted files
  database: "data/csoj.db"              # SQLite database file
  submission_log: "data/logs"           # Logs from judging containers

# Authentication configuration
auth:
  jwt:
    secret: "a_very_secret_key_change_me" # JWT signing secret, MUST be changed
    expire_hours: 72                      # JWT expiration time in hours
  
  # Local username/password authentication
  local:
    enabled: true
  
  # GitLab OAuth2 authentication
  gitlab:
    url: "[https://gitlab.com](https://gitlab.com)"             # GitLab instance URL
    client_id: "YOUR_GITLAB_CLIENT_ID"
    client_secret: "YOUR_GITLAB_CLIENT_SECRET"
    redirect_uri: "http://localhost:8080/api/v1/auth/gitlab/callback"

# Cross-Origin Resource Sharing (CORS) configuration
cors:
  allowed_origins:
    - "http://localhost:3000"
    - "[http://127.0.0.1:3000](http://127.0.0.1:3000)"

# Judger cluster configuration
cluster:
  - name: "default-cluster" # Cluster name, referenced in problem configs
    node:
      - name: "node-1"
        cpu: 4              # Total CPU cores available for judging
        memory: 4096        # Total memory (in MB) available for judging
        docker: "tcp://192.168.1.101:2375" # Docker Daemon address for this node
      - name: "node-2"
        cpu: 8
        memory: 8192
        docker: "tcp://192.168.1.102:2375"

# List of paths to contest configuration directories
contest:
  - "contests/intro-contest"
  - "contests/final-contest"
```

-----

## Field Reference

### `listen`

  - **Type**: `string`
  - **Required**: Yes
  - **Description**: The listen address and port for the user-facing API service.

-----

### `admin`

  - **Type**: `object`
  - **Required**: No
  - **Description**: Configuration for the Admin API service.
      - `enabled`: (boolean) Whether to enable the Admin API service.
      - `listen`: (string) The listen address and port for the Admin API service.

-----

### `logger`

  - **Type**: `object`
  - **Required**: Yes
  - **Description**: Configuration for the logging system.
      - `level`: (string) Log level. `debug` provides more verbose output, while `production` is more concise.
      - `file`: (string) Path to a log file. If left empty, logs are written to standard error (the console).

-----

### `storage`

  - **Type**: `object`
  - **Required**: Yes
  - **Description**: Defines storage paths for various system files.
      - `user_avatar`: (string) Directory to store user-uploaded avatars.
      - `submission_content`: (string) Directory to store user-submitted code/files.
      - `database`: (string) Path to the SQLite database file.
      - `submission_log`: (string) Directory to store log files generated by each judging container.

-----

### `auth`

  - **Type**: `object`
  - **Required**: Yes
  - **Description**: User authentication settings.
      - `jwt`: (object)
          - `secret`: (string) The secret key used to sign and verify JWTs. **You must change this to a complex random string in production.**
          - `expire_hours`: (integer) The validity period of a JWT, in hours.
      - `local`: (object)
          - `enabled`: (boolean) Whether to enable the local username and password registration/login feature.
      - `gitlab`: (object)
          - `url`: (string) The URL of your GitLab instance.
          - `client_id`: (string) The Client ID obtained after creating an application in GitLab.
          - `client_secret`: (string) The Client Secret obtained after creating an application in GitLab.
          - `redirect_uri`: (string) The callback URL configured in your GitLab application, which must exactly match this URI.

-----

### `cors`

  - **Type**: `object`
  - **Required**: No
  - **Description**: Configures Cross-Origin Resource Sharing (CORS) for the API.
      - `allowed_origins`: (array of strings) A list of origins that are allowed to access the API. You can add your frontend application's address here. Supports `*` as a wildcard.

-----

### `cluster`

  - **Type**: `array of objects`
  - **Required**: Yes
  - **Description**: Defines one or more judger clusters. Each cluster consists of one or more judger nodes.
      - `name`: (string) A unique name for the cluster. This name is used in problem configurations to specify which cluster to use for judging.
      - `node`: (array of objects) The list of judger nodes in this cluster.
          - `name`: (string) A unique name for the node.
          - `cpu`: (integer) The total number of CPU cores that the scheduler can use on this node. The scheduler ensures that the total CPU requested by concurrently running tasks does not exceed this value.
          - `memory`: (integer) The total amount of memory (in MB) that the scheduler can use on this node.
          - `docker`: (string) The API address of the Docker Daemon on this node, typically a TCP address. **Ensure the Docker Daemon is configured to listen on this TCP port and is reachable over the network.**

-----

### `contest`

  - **Type**: `array of strings`
  - **Required**: Yes
  - **Description**: A list of paths to all contest configuration directories. CSOJ scans these directories on startup to load contest and problem information.
